<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/gittest/src/main/webapp/folde1/css/Feed.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css"
    integrity="sha512-1ycn6IcaQQ40/MKBW2W4Rhis/DbILU74C1vSrLJxCq57o941Ym01SwNsOMqvEBFlcgUa6xLiPY/NS5R+E6ztJQ=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@9/swiper-bundle.min.css"/>
</head>

<body>
  <!-- sidebar section Start -->
  <div class="sidebar">
    <div class="sidebarOption_logo"> 
      <img src="/gittest/src/main/webapp/folde1/img/homelogo.png">
    </div>
    <div class="sidebarOption">
      <i class="fa-solid fa-house-chimney"></i>
      <a href="/gittest/src/main/webapp/folde1/Feed.html"><h2>홈</h2></a>
    </div>
    <div class="sidebarOption">
      <i class="fa-sharp fa-solid fa-magnifying-glass"></i>
      <a href="/gittest/src/main/webapp/folde2/search.html"><h2>트렌드</h2></a>
    </div>
    <div class="sidebarOption">
      <i class="fa-solid fa-envelope"></i>
      <a href="/gittest/src/main/webapp/folde2/todayspick.html"><h2>Today's Pick!</h2></a>
    </div>
    <div class="sidebarOption">
      <i class="fa-solid fa-user"></i>
      <a href="/gittest/src/main/webapp/folde2/profile_post.html"><h2>프로필</h2></a>
    </div>
    <div class="profile_btn" onclick="dropdown()">
      <div class="user_info">
        <img src="/gittest/src/main/webapp/folde1/img/129.png" class="user_profile_img" style="width: 55px; height: 55px;">
        <div class="name">
          <p class="user_nick">admin</p>
          <p class="user_id">@admin</p>
        </div>
        <div class="user_profile_op">
          <i class="fa-solid fa-angles-down"></i>          
        </div>
      </div>
    </div>
    <div class="sidebar_dropdown-content" id="dropdown-content">
      <p onclick="logout()">로그아웃</p>
    </div>
  </div>
    <!-- sidebar section end -->

  <!-- feed section start -->
  <!-- post box -->
  <div class="feed">
    <div class="feed_header">
      <h2>홈</h2>
    </div>
    <div class="postbox">
      
        <div class="input_box">
          <div class="postbox_area">
            <textarea name="" cols="40" rows="5" placeholder="무슨 일이 일어나고 있나요?"></textarea>
            <div class="tag"></div>
          </div> 
        </div>     
        <div class="postbox_image-container"></div>
        <div class="postbox_tag"></div>
        <div class="postbox_footer">
          <div class="footer-icon">
            <div class="add-img">
              <i class="far fa-file-image"><input type="file" name="c_img" style="display: none;" accept="image/*"></i>
            </div>
            <div class="add_map">
              <i class="fa-solid fa-location-dot"></i>
            </div>
            <div class="add_tage">
              <i class="fa-regular fa-hashtag" onclick="dropdown_tage()"></i>
            </div>
          </div>
          <div class="post-submit">
            <button class="postbox_btn" type="submit">글쓰기</button>
          </div>
        </div>  
      
      <div class="tag_wrapper" id="tage_dropdown-content">
        <div class="title">
          <i class="fa-solid fa-tags"></i>
          <h2>태그</h2>
        </div>
          <div class="tag_content">
            <div class="tag_box">
              
                <ul><input type="text" name="" placeholder="원하는 태그를 입력 해 주세요" id="tag_input">
                  <div class="tag_details">
                    <button id="add_postboxTags">태그 추가</button>
                  </div>
                </ul>
             
            </div>
          </div> 
      </div>   
    </div>
    <!-- post box end -->
    <!-- post list start-->
    <div class="post_list">
      <div class="post_list_box">
        <div class="content">
          <div class="post_profile" style="float: left;">
            <img src="/gittest/src/main/webapp/folde1/img/129.png" alt="">
          </div>
          <div class="user_name_time">
            <h5 name="user_nick">
              admin
              <p name="user_id">@admin</p>
            </h5>
            <h6><i class="far fa-clock" name="c_date"></i>25 mins</h6>
            <i class="fa-solid fa-trash-can" onclick="delete_postlist()"></i>
          </div>
          <div class="content_text" name="post-content">
            <span>a 태그는 링크를 걸어주는 태그로 href, target, rel 속성이 있다. 각 속성에는 다양한 속성값이 있다. id와 class 속성은 body 영역에서 사용할 수 있는데 모든 태그에서 사용할 수 있다. id 속성은 고유한 이름이며, class 속성은 중복해서 이름을 지정할 수 있다.</span>
          </div>
          <div class="tags_output">
            <span>#태그가_출력될_자리입니다.</span>
          </div>
          <div class="img_post_bx">
            <img src="/gittest/src/main/webapp/img/AdobeStock_523835731.png" alt="">
          </div>
          <div class="post_card_social_data">
            <div class="post_social_card" onclick="dropdowncommentinput()">
              <i class="fas fa-comment"></i>
              <span name="comment_cnt">0</span><!-- 댓글 수-->
            </div>
            <div class="post_social_card">
              <i class="fas fa-heart"></i>
              <span name="like_cnt">0</span>
            </div>
            <div class="post_social_card" >
              <i class="fa-solid fa-map-location-dot"></i>
            </div>
          </div>
          <div class="dropdown-comment">
            
              <input type="text" name="commentInput">
              <button class="commentBtn">댓글입력</button>
            
          </div>
          <div class="comment_list">
            
          </div>
        </div>
      </div>
    </div>
    <!-- post list end-->
  </div>
  <!-- feed section end -->

  <!-- widget section Start -->
  <div class="widgets">
    <div class="widgets_product_Container">
      <div class="widgets_header">
        <h2>친환경 상품</h2>
      </div>
            <!-- Slider main container -->
            <div class="swiper mySwiper">
              <div class="swiper-wrapper">
                <div class="swiper-slide">Slide 1</div>
                <div class="swiper-slide">Slide 2</div>
                <div class="swiper-slide">Slide 3</div>
                <div class="swiper-slide">Slide 4</div>
                <div class="swiper-slide">Slide 5</div>
              </div>
              <div class="swiper-pagination"></div>
            </div>
    </div>
    
    <div class="widgets_weather_Container">
    <div class="widgets_header">
      <h2>날씨</h2>
    </div>  
    <div class="weather_card">
      <div class="error">
        <p>위치정보를 찾을 수 없습니다.</p>
      </div>
      <div class="weather">
        <img src="/gittest/src/main/webapp/folde1/img/icon/1530391_clouds_sun_sunny_weather.png" class="weather-icon">
        <h1 class="temp"></h1>
        <h2 class="city_result"></h2> 
        <div class="details">
          <div class="col">
            <img src="/gittest/src/main/webapp/img/icon/cloud_forecast_rain_humidity_weather_icon_228446.png" alt="">
              <div class="col_text">
              <p class="humidity"></p>
              <p>습도</p>
          </div>
          <div class="col">
            <img src="/gittest/src/main/webapp/img/icon/wind_icon-icons.com_64274.png" alt="">
              <div class="col_text">
                <p class="windy_speed"></p>
                <p>풍속</p>
              </div>
          </div>
        </div>
      </div>
    </div>
  </div>    
  </div>
  <!-- widget section end -->
  
<!-- map popup section Start -->
<div class="popup">
  <header>
    <div class="close"><i class="fa-solid fa-xmark"></i></div>
  </header>
  <div class="modal_content">
    <div class="map" style="width:380px;height:280px;"></div>
  </div>
</div>

<!-- popup section end -->

  <!-- js file section -->
  <script src="//dapi.kakao.com/v2/maps/sdk.js?appkey=cc62bb43e9feeb15374bcc3b80292f46"></script>
  <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
  <script src="https://kit.fontawesome.com/369266d994.js" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/swiper@9/swiper-bundle.min.js"></script>







<script>

  //사이드 바 안의 로그아웃 메뉴
function dropdown() {
    var dropdownContent = document.getElementById("dropdown-content");
    dropdownContent.classList.toggle("show");
  }
  
  
  
  function logout() {
    var dropdownContent = document.getElementById("dropdown-content");
    dropdownContent.classList.remove("show");
    // '로그아웃' 삭제 수행
  }
  
  
  // 댓글창 보이기
  function dropdowncommentinput() {
      var dropdownComment = document.querySelector(".dropdown-comment");
      dropdownComment.classList.add("show_dropdown_comment");
    }

  //댓글 기능
  // Get the comment input element and the comment list element
const commentInput = document.querySelector('input[name="commentInput"]');
const commentList = document.querySelector('.comment_list');

// Get the comment count element and the initial comment count
const commentCount = document.querySelector('span[name="comment_cnt"]');
let count = parseInt(commentCount.innerText);

// Add a click event listener to the comment submit button
const commentBtn = document.querySelector('.commentBtn');
commentBtn.addEventListener('click', () => {
  // Get the comment text from the input element
  const commentText = commentInput.value;
  
  // Create a new comment element
  const newComment = document.createElement('div');
  newComment.classList.add('dropdown-comment_list');
  newComment.innerHTML = `
    <div class="post_profile" style="float: left;">
      <img src="/gittest/src/main/webapp/folde1/img/129.png" alt="">
    </div>
    <div class="user_name_time_comment">
      <h5 name="user_nick">
        admin
        <p name="user_id">@admin</p>
        <h6><i class="far fa-clock" name="c_date"></i>now</h6>
        <i class="fa-solid fa-trash-can" onclick="delete_comment()"></i>
      </h5>
    </div>
    <div class="comment_text">
      <span>${commentText}</span>
    </div>
  `;
  
  // Append the new comment to the comment list
  commentList.appendChild(newComment);
  
  // Increase the comment count
  count++;
  commentCount.innerText = count;
  
  // Clear the comment input
  commentInput.value = '';
  
}); 


  // 사이드바 링크 활성화 부분//
  const links = document.querySelectorAll('.sidebarOption a');

  const currentUrl = window.location.href;
  
  links.forEach(link => {
    if (link.href === currentUrl) {
      link.classList.add('active');
    } else {
      link.classList.add('default');
    }
  }); 
  
  
  // 좋아요 색깔 , 숫자
  const heartIcons = document.querySelectorAll('.fas.fa-heart');
    const likeCounts = document.querySelectorAll('[name="like_cnt"]');
    let isLiked = [];

    for (let i = 0; i < heartIcons.length; i++) {
    isLiked.push(false); // Initialize all isLiked variables to false
    heartIcons[i].addEventListener('click', function() {
    if (!isLiked[i]) {
        heartIcons[i].style.color = 'red';
        likeCounts[i].textContent = Number(likeCounts[i].textContent) + 1;
        isLiked[i] = true;
      } else {
        heartIcons[i].style.color = 'rgb(0,0,0,0.2)';
        likeCounts[i].textContent = Number(likeCounts[i].textContent) - 1;
        isLiked[i] = false;
      }
      });
    }
  
  
  
  //태그입력 창 열기
  function dropdown_tage() {
    document.getElementById("tage_dropdown-content").classList.toggle("show_tag");
  }
  const addBtn = document.getElementById("add_postboxTags");
  const tagInput = document.getElementById("tag_input");
  const tagContainer = document.querySelector(".postbox_tag");

  addBtn.addEventListener("click", function() {
    const tagValue = tagInput.value.trim(); // 입력한 값의 앞뒤 공백 제거
    if (tagValue) { // 입력값이 있을 때만 실행
      const tag = document.createElement("span"); // 새로운 span 태그 생성
      tag.textContent = tagValue; // span 태그의 텍스트 콘텐츠에 입력한 값을 할당
      tagContainer.appendChild(tag); // 생성한 span 태그를 tagContainer에 추가
      tagInput.value = ""; // 입력필드 초기화
    }
  });

// 파일 선택 창 열기 및 이미지 프리뷰, 이미지 삭제
document.querySelector('.add-img').addEventListener('click', function() {
    document.querySelector('input[name="c_img"]').click();
});

document.querySelector('input[name="c_img"]').addEventListener('change', function(event) {
    var file = event.target.files[0];
    var reader = new FileReader();
    reader.onload = function(e) {
        var img = document.createElement('img');
        img.src = e.target.result;
        document.querySelector('.postbox_image-container').innerHTML = '';
        document.querySelector('.postbox_image-container').appendChild(img);
        
        var icon = document.createElement('i');
        icon.classList.add('fa-solid', 'fa-xmark');
        icon.addEventListener('click', function() {
            document.querySelector('.postbox_image-container').removeChild(img);
            document.querySelector('.postbox_image-container').removeChild(icon);
        });
        
        document.querySelector('.postbox_image-container').appendChild(icon);
    };
    reader.readAsDataURL(file);
});

  //날씨 정보 기능 
  // Geolocation API에 액세스할 수 있는지를 확인
  if (navigator.geolocation) {
    //위치 정보를 얻기
    navigator.geolocation.getCurrentPosition (function(pos) {
        const lat = pos.coords.latitude;     // 위도
        const lon = pos.coords.longitude; // 경도
        
        const apikey='e89bb3afd798d5b46c49698f627bf5eb';
        const apiUrl = 'http://api.openweathermap.org/data/2.5/weather?'
        const weatherIcon =document.querySelector(".weather-icon")
       
        async function getWeather(){
        const response = await fetch(apiUrl+`lat=`+lat+`&lon=`+lon+`&lang=kr&APPID=${apikey}`);
        if(response.status==404){
            document.querySelector(".weather").style.display="none";
            document.querySelector(".error").style.display="block";
        }else{
            var data = await response.json();  
            console.log(data);
        // display weather data on webpage
        
        document.querySelector(".humidity").innerHTML = data.main.humidity+"<span>&nbsp;%</span>";        
        document.querySelector(".windy_speed").innerHTML = data.wind.speed+"<span>&nbsp;km/h</span>";        
        document.querySelector(".city_result").innerHTML = data.name;                
        document.querySelector(".temp").innerHTML = Math.round(Number(data.main.temp) - 273.15)+"<span>&nbsp;°C</span>";        
            
        if(data.weather[0].main=="Clear"){
            weatherIcon.src="/gittest/src/main/webapp/folde1/img/icon/1530392_weather_sun_sunny_temperature.png";
        }
        else if(data.weather[0].icon=="01n"){
            weatherIcon.src="/gittest/src/main/webapp/folde1/img/icon/1530382_weather_night_moon_moonlight.png";
        }
        else if(data.weather[0].icon=="04n"){
            weatherIcon.src="/gittest/src/main/webapp/folde1/img/icon/1530383_moon_weather_clouds_cloudy.png";
        }
        else if(data.weather[0].main=="Clouds"){
            weatherIcon.src="/gittest/src/main/webapp/folde1/img/icon/1530369_cloudy_weather_clouds_cloud.png";
        }
        else if(data.weather[0].icon=="02d"){
            weatherIcon.src="/gittest/src/main/webapp/folde1/img/icon/1530391_clouds_sun_sunny_weather.png";
        }
        else if(data.weather[0].id==500){
            weatherIcon.src="/gittest/src/main/webapp/folde1/img/icon/1530390_sunny_rain_cloudy_weather_clouds.png";
        }
        else if(data.weather[0].main=="Rain"){
            weatherIcon.src="/gittest/src/main/webapp/folde1/img/icon/1530364_rain_storm_shower_weather.png";
        }
        else if(data.weather[0].main=="Drizzle"){
            weatherIcon.src="/gittest/src/main/webapp/folde1/img/icon/1530365_rain_cloud_drizzel_weather.png";
        }
        else if(data.weather[0].main=="Mist"){
            weatherIcon.src="/gittest/src/main/webapp/folde1/img/icon/1530368_foggy_weather_fog_clouds_cloudy.png";
        }
        else if(data.weather[0].main=="Snow"){
            weatherIcon.src="/gittest/src/main/webapp/folde1/img/icon/1530371_winter_snow_clouds_weather.png";
        } 
        document.querySelector(".weather").style.display="block";
        document.querySelector(".error").style.display="none";
  
        }
  
        
    };
        
        getWeather();
        
    });
        
  
  } else {
    alert("이 브라우저에서는 Geolocation이 지원되지 않습니다.")
  }
  
  //게시물 및 댓글 삭제
  function delete_comment() {
  const dropdownCommentList = document.querySelector('.dropdown-comment_list');
  dropdownCommentList.remove();

  const commentCnt = document.querySelector('[name="comment_cnt"]');
  const commentCntValue = parseInt(commentCnt.textContent);
  commentCnt.textContent = commentCntValue - 1;

  if (commentCntValue === 1) {
    commentCnt.textContent = 0;
  } else if (commentCntValue === 0) {
    commentCnt.textContent = 1;
  }
}

const trashCan = document.querySelector('.fa-trash-can');
trashCan.addEventListener('click', delete_comment);


function delete_postlist() {
  const dropdownCommentList = document.querySelector('.post_list_box');
  dropdownCommentList.remove();
}

const delete_list = document.querySelector('.fa-trash-can');
delete_list.addEventListener('click', delete_postlist);


//지도 확인 기능
var popup = document.querySelector(".popup");

// Select all the map location icon elements
var mapLocationIcons = document.querySelectorAll(".fa-location-dot");

// Add a click event listener to each map location icon
mapLocationIcons.forEach(function(mapLocationIcon) {
  mapLocationIcon.addEventListener("click", function() {
    // Get the user's current location using geolocation
    navigator.geolocation.getCurrentPosition(function(position) {
      // Toggle the visibility of the popup
      popup.classList.toggle("show");

      // Create the map centered on the user's location
      var mapContainer = popup.querySelector('.map');
      var mapOption = {
        center: new kakao.maps.LatLng(position.coords.latitude, position.coords.longitude),
        level: 3,
        mapTypeId : kakao.maps.MapTypeId.ROADMAP
      }; 
      var map = new kakao.maps.Map(mapContainer, mapOption);
      var mapTypeControl = new kakao.maps.MapTypeControl();

      // Add a marker to the map at the user's location
      var marker = new kakao.maps.Marker({
        position: new kakao.maps.LatLng(position.coords.latitude, position.coords.longitude),
        draggable: true,
        map: map
      });

      // 지도의 상단 우측에 지도 타입 변경 컨트롤을 추가한다
      map.addControl(mapTypeControl, kakao.maps.ControlPosition.TOPRIGHT);

      // Add a click listener to the popup's close button
      var close = popup.querySelector(".close");
      close.onclick = function() {
        // Remove the popup from the page
        popup.classList.remove("show");

        // Remove the map and marker objects
        marker.setMap(null);
        map = null;
      };
    }, function(error) {
      // Handle geolocation errors
      console.error(error);
      if (popup.classList.contains("show")) {
        popup.classList.remove("show");
      }
      alert("위치정보를 찾을 수 없습니다.");
    });
  });
});


//게시물에 있는 지도 확인 부분
// Select the popup element
var popup_map = document.querySelector(".popup");

// Select all the map location icon elements
var mapLocationIcons = document.querySelectorAll(".fa-map-location-dot");

// Add a click event listener to each map location icon
mapLocationIcons.forEach(function(mapLocationIcon) {
  mapLocationIcon.addEventListener("click", function() {
    // Toggle the visibility of the popup
    popup_map.classList.toggle("show");

    // Create the map
    var mapContainer = popup_map.querySelector('.map');
    var mapOption = {
      center: new kakao.maps.LatLng(37.56675, 126.97870), //위도 경도 수정부분
      level: 3,
      mapTypeId : kakao.maps.MapTypeId.ROADMAP
    }; 
    var map = new kakao.maps.Map(mapContainer, mapOption);
    var mapTypeControl = new kakao.maps.MapTypeControl();

    // 지도의 상단 우측에 지도 타입 변경 컨트롤을 추가한다
    map.addControl(mapTypeControl, kakao.maps.ControlPosition.TOPRIGHT);

    // Add a marker to the map
    var marker = new kakao.maps.Marker({
      position: new kakao.maps.LatLng(37.56675, 126.97870), //마커 생성 위도 경도 수정 부분 
      draggable: true,
      map: map
    });

    // Add a click listener to the popup's close button
    var close = popup_map.querySelector(".close");
    close.onclick = function() {
      // Remove the popup from the page
      popup_map.classList.remove("show");

      // Remove the map and marker objects
      marker.setMap(null);
      map = null;
    };
  });
});



// 상품 소개 슬라이더
var swiper = new Swiper(".mySwiper", {
      spaceBetween: 30,
      centeredSlides: true,
      autoplay: {
        delay: 2500,
        disableOnInteraction: false,
      },
      pagination: {
        el: ".swiper-pagination",
        clickable: true,
      },
      navigation: {
        nextEl: ".swiper-button-next",
        prevEl: ".swiper-button-prev",
      },
    });


</script>
</body>
</html>